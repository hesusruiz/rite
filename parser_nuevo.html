<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Authentication and Authorization with Verifiable Credentials using using did:elsi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Opengraph Facebook Meta Tags -->
    <meta property="og:title" content="Authentication and Authorization with Verifiable Credentials using using did:elsi">
    <meta property="og:type" content="website">
    <meta property="og:description" content="Authentication and Authorization with Verifiable Credentials using using did:elsi">
    <meta property="og:site_name" content="Authn with Verifiable Credentials">
    <meta property="og:url" content="https://alastria.github.io/did-method-elsi/authzn.html">

    <script src="https://www.w3.org/Tools/respec/respec-w3c" async="" class="remove"></script>
    <script class="remove">
        var respecConfig = {
            latestVersion: "https://alastria.github.io/did-method-elsi/authzn.html",
            edDraftURI: "https://alastria.github.io/did-method-elsi/authzn.html",
            github: "https://github.com/alastria/did-method-elsi/blob/main/authzn.html",
            editors: [
                {
                    company: "JesusRuiz",
                    companyURL: "https://hesusruiz.github.io/hesusruiz",
                    email: "hesusruiz@gmail.com",
                    name: "Jesus Ruiz",
                },
            ],
            authors: [
                {
                    company: "JesusRuiz",
                    companyURL: "https://hesusruiz.github.io/hesusruiz",
                    email: "hesusruiz@gmail.com",
                    name: "Jesus Ruiz",
                },
                {
                    company: "nicos AG",
                    companyURL: "https://www.nicos-ag.com/",
                    email: "jlangkau@nicos-ag.com",
                    name: "Jörg Langkau ",
                },
            ],
            localBiblio: {
                "DEP-DSS": {
                        date: "2019-10",
                        href: "https://ec.europa.eu/digital-building-blocks/wikis/display/DIGITAL/Qualified+electronic+signature+-+QES+validation+algorithm",
                        publisher: "European Commission",
                        title: "Algorithm for Validation of qualified and advanced signatures and seals",
                },
                "DID-DNS": {
                        href: "https://tools.ietf.org/html/draft-mayrhofer-did-dns-01",
                        publisher: "IETF",
                        status: "Internet Draft",
                        title: "The Decentralized Identifier (DID) in the DNS",
                },
                "DID-ELSI": {
                        date: "04 June 2023",
                        href: "https://alastria.github.io/did-method-elsi/",
                        title: "DID ETSI Legal person Semantic Identifier Method Specification (did:elsi)",
                },
                "DID-ONBOARDING": {
                        date: "04 June 2023",
                        href: "https://alastria.github.io/did-method-elsi/onboarding.html",
                        title: "Onboarding example with LEARCredential using did:elsi",
                },
                "DID-PRIMER": {
                        href: "https://github.com/WebOfTrustInfo/rebooting-the-web-of-trust-fall2017/blob/master/topics-and-advance-readings/did-primer.md",
                        publisher: "Rebooting the Web of Trust 2017",
                        title: "DID Primer",
                },
                "DIF.PresentationExchange": {
                        href: "https://identity.foundation/presentation-exchange/spec/v2.0.0/",
                        title: "Presentation Exchange 2.0.0",
                },
                "ETSI-CERTOVERVIEW": {
                        date: "2020-07",
                        href: "https://www.etsi.org/deliver/etsi_en/319400_319499/31941201/01.04.02_20/en_31941201v010402a.pdf",
                        publisher: "ETSI",
                        title: "ETSI EN 319 412-1 V1.4.2 (2020-07) - Electronic Signatures and Infrastructures (ESI); Certificate Profiles; Part 1: Overview and common data structures",
                },
                "ETSI-JADES": {
                        date: "2021-03",
                        href: "https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf",
                        publisher: "ETSI",
                        title: "ETSI TS 119 182-1 V1.1.1 (2021-03) - Electronic Signatures and Infrastructures (ESI); JAdES digital signatures; Part 1: Building blocks and JAdES baseline signatures",
                },
                "ETSI-LEGALPERSON": {
                        date: "2020-07",
                        href: "https://www.etsi.org/deliver/etsi_en/319400_319499/31941203/01.02.01_60/en_31941203v010201p.pdf",
                        publisher: "ETSI",
                        title: "ETSI EN 319 412-3 V1.2.1 (2020-07) - Electronic Signatures and Infrastructures (ESI); Certificate Profiles; Part 3: Certificate profile for certificates issued to legal persons",
                },
                "NIST-AUTH": {
                        date: "October 2016",
                        href: "https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-178.pdf",
                        title: "NIST Special Publication 800-178: A Comparison of Attribute Based Access Control (ABAC) Standards for Data Service Applications",
                },
                "OWASP-TRANSPORT": {
                        href: "https://www.owasp.org/index.php/Transport_Layer_Protection_Cheat_Sheet",
                        title: "Transport Layer Protection Cheatsheet",
                },
                "OpenID.Core": {
                        date: "8 November 2014",
                        href: "http://openid.net/specs/openid-connect-core-1_0.html",
                        title: "OpenID Connect Core 1.0 incorporating errata set 1",
                },
                "OpenID.SIOP2": {
                        date: "28 January 2022",
                        href: "https://openid.bitbucket.io/connect/openid-connect-self-issued-v2-1_0.html",
                        title: "Self-Issued OpenID Provider v2",
                },
                "OpenID.VCI": {
                        date: "3 February 2023",
                        href: "https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html",
                        title: "OpenID for Verifiable Credential Issuance",
                },
                "OpenID.VP": {
                        date: "21 April 2023",
                        href: "https://openid.net/specs/openid-4-verifiable-presentations-1_0.html",
                        title: "OpenID for Verifiable Presentations",
                },
                "RFC6749": {
                        href: "https://www.rfc-editor.org/rfc/rfc6749.html",
                        title: "The OAuth 2.0 Authorization Framework",
                },
                "RFC7515": {
                        href: "https://www.rfc-editor.org/rfc/rfc7515",
                        title: "JSON Web Signature (JWS)",
                },
                "RFC7519": {
                        href: "https://www.rfc-editor.org/rfc/rfc7519",
                        title: "JSON Web Token (JWT)",
                },
                "RFC8414": {
                        href: "https://www.rfc-editor.org/rfc/rfc8414",
                        title: "OAuth 2.0 Authorization Server Metadata",
                },
                "RFC8725": {
                        href: "https://www.rfc-editor.org/rfc/rfc8725",
                        title: "JSON Web Token Best Current Practices",
                },
            },
        };
    </script>
    <style>
        code {
            color: red;
        }
        pre.nohighlight {
            padding: 0.5em
        }
        ul.plain {
            list-style: none;
        }
        ul.plain li {
            text-indent: -1em;
        }
        ul.plain li>div {
            text-indent:0;
        }
        ul.plain li>p {
            text-indent:0;
        }
    </style>
</head>

<body>
    <p class="copyright">
        Copyright © 2023 the document editors/authors. Text is available under the <a rel="license" href="https://creativecommons.org/licenses/by/4.0/legalcode"> Creative Commons Attribution 4.0 International Public License</a>
    </p>


<section id='abstract'>
    <p>Once an organisation has onboarded an ecosystem like a Data Space, some of its employees have to be appointed to enable them to perform a concrete set of activities in the ecosystem. These activities are performed in the web portals of different organisations which are already participants in the ecosystem, like the onboarding service, the marketplace portals and also in the web portals of other participants.
    </p>
    <p>This document describes how:
    </p>
    <ul>
        <li id='126'><a href='#126' class='selfref'><b>-</b></a> An organisation can issue Verifiable Credentials to its employees enabling them to perform some specific processes in other organisations "on-behalf-of" the employer
        </li>
        <li id='127'><a href='#127' class='selfref'><b>-</b></a> Other organisations can accept those Verifiable Credentials to perform authentication and access control.
        </li>
    </ul>
    <p>We assume that all organisations have onboarded in the ecosystem using the mechanisms described in [[[DID-ELSI]]] and [[[DID-ONBOARDING]]].
    </p>
</section>
<section id='conformance'>
</section>
<section><h2>Introduction</h2>

    <p>Once an organisation has onboarded an ecosystem like a Data Space, some of its employees have to be appointed to enable them to perform a concrete set of activities in the ecosystem. These activities are performed in the web portals of different organisations which are already participants in the ecosystem, like the onboarding service, the marketplace portals and also in the web portals of other participants.
    </p>
    <p>This document describes how:
    </p>
    <ul>
        <li id='141'><a href='#141' class='selfref'><b>-</b></a> An organisation can issue Verifiable Credentials to its employees enabling them to perform some specific processes in other organisations "on-behalf-of" the employer
        </li>
        <li id='142'><a href='#142' class='selfref'><b>-</b></a> Other organisations can accept those Verifiable Credentials to perform authentication and access control.
        </li>
    </ul>
    <p>We assume that all organisations have onboarded in the ecosystem using the mechanisms described in [[[DID-ELSI]]] and [[[DID-ONBOARDING]]].
    </p>
    <p>The appointed employee will perform the process by using a special type of Verifiable Credential called <code>LEARCredential</code> (from <b>L</b>egal <b>E</b>ntity <b>A</b>ppointed <b>R</b>epresentative).
    </p>
    <p>To achieve a high level of legal certainty under eIDAS, the LEARCredential is:
    </p>
    <ul>
        <li id='151'><a href='#151' class='selfref'><b>-</b></a> signed or sealed with an eIDAS certificate which is either:
            <div>
            <ul>
                <li id='154'><a href='#154' class='selfref'><b>-</b></a> a <b>certificate for electronic seals</b> issued to a legal person by a Qualified Trust Service Provider, or
                </li>
                <li id='155'><a href='#155' class='selfref'><b>-</b></a> a <b>certificate for electronic signatures</b>, issued to a <b>legal representative of the legal person</b> by a Qualified Trust Service Provider.
                </li>
            </ul>
            </div>
        </li>
        <li id='156'><a href='#156' class='selfref'><b>-</b></a> signed using the <b>JSON Advanced Electronic Signature</b> format described in [[[ETSI-JADES]]]
        </li>
    </ul>
    <p>The LEARCredential includes claims identifying the employee and a description of the concrete powers that have been delegated by the legal representative of the organisation.
    </p>
    <p>By signing/sealing the credential with an eIDAS certificate, the legal representative attests that the powers described in the credential have been delegated to the employee (maybe under some conditions, also described in the credential).
    </p>
    <p>In this way, the LEARCredential has the same legal status as any other document in other formats (e.g., PDF) signed in an eIDAS-compliant way, but with all the advantages provided by the Verifiable Credential format.
    </p>
    <p>In addition, the LEARCredential includes cryptographic material that allows the appointed employee to <b>use the credential as an online authentication mechanism</b> in a portal, by proving that the holder of the credential is the same person identified in the credential.
    </p>
    <p>Any Verifier that trusts the eIDAS Trust Framework will be able to verify that:
    </p>
    <ul>
        <li id='169'><a href='#169' class='selfref'><b>-</b></a> <b>The person presenting the LEARCredential is the same as the one identified in the credential</b>
        </li>
        <li id='170'><a href='#170' class='selfref'><b>-</b></a> <b>A legal representative of the organisation has attested that the person has the powers described in the credential</b>
        </li>
    </ul>
    <p>This enables the person presenting the LEARCredential to start the process and to provide any additional required documentation, preferably as additional Verifiable Credentials to enable automatic verification of compliance with the process requirements (including Gaia-X credentials issued by the Compliance Service of Gaia-X). 
    </p>
    <p>Both types of eIDAS certificates mentioned above are an electronic attestation <b>that links electronic seal/signature validation data to a legal person and confirms the name of that person</b>. This way, the certificate, usually linked to the sealed/signed document, can be used to verify the identity of the creator of the seal/signature and whether the document has been sealed/signed using the corresponding private key.
    </p>
    <p>Before issuing a certificate like the above, the Qualified Trust Service Provider (QTSP) performs validations against `Authentic Sources` to authenticate the identity of the organisation:
    </p>
    <ul>
        <li id='179'><a href='#179' class='selfref'><b>-</b></a> The data concerning the business name or corporate name of the organisation.
        </li>
        <li id='180'><a href='#180' class='selfref'><b>-</b></a> The data relating to the constitution and legal status of the subscriber.
        </li>
        <li id='181'><a href='#181' class='selfref'><b>-</b></a> The data concerning the extent and validity of the powers of representation of the applicant.
        </li>
        <li id='182'><a href='#182' class='selfref'><b>-</b></a> The data concerning the tax identification code of the organisation or equivalent code used in the country to whose legislation the subscriber is subject.
        </li>
    </ul>
    <p>The person controlling the above certificates will appoint a legal entity representative (LEAR) by generating and signing a Verifiable Credential which:
    </p>
    <ul>
        <li id='187'><a href='#187' class='selfref'><b>-</b></a> Includes identification data of an employee of the organisation
        </li>
        <li id='188'><a href='#188' class='selfref'><b>-</b></a> Includes claims stating the delegation of specific powers to perform a set of specific processes on behalf of the organisation
        </li>
        <li id='189'><a href='#189' class='selfref'><b>-</b></a> Includes a public key where the corresponding private key is controlled by the employee, enabling him to prove that he is the holder of the credential when it is being used in an authentication process like the ones used as examples in this document.
        </li>
    </ul>
    <p>The LEARCredential uses the `did:elsi` method for the identifiers of legal persons involved in the process, to facilitate the DID resolution and linkage with the eIDAS certificates. The `did:elsi` method is specified in [[[DID-ELSI]]].    
    </p>
    <p>The high-level view of the process is described in the following diagram, when a COO (Chief Operating Officer) appoints an employee to perform some processes:
    </p>
    <figure><img src='builtassets/plantuml_53418b3092cb323db978af09dc064024.png' alt=''>
    <figcaption>High level view of issuance of LEARCredential</figcaption></figure>

</section>
<section><h2>Participants</h2>

    <p>Here we introduce the actors of the reference use case we are going to use. The main actors are marked in yellow in the following diagram.
    </p>
    <p>RealTruth is a Trust Service Provider operating under the eIDAS Trust Framework, which issues a certificate for seals to the company GoodAir. GoodAir is a business that provides some services using an Air Quality application operated by GoodAir.
    </p>
    <p>RealTruth also provides a certificate for signatures to the COO of the GoodAir company, so the COO can use the certificate to sign documents on behalf of GoodAir (like contracts, invoices, financial reports, ...) in a way that is compliant with eIDAS.
    </p>
    <p>The COO of GoodAir will issue a verifiable credential of type LEARCredential to an employee of GoodAir, signing the credential with his certificate for signatures.
    </p>
    <figure><img src='builtassets/diagram_db3fa4b2cb90f64b9ccf84f7fe660073.svg' alt=''>
    <figcaption></figcaption></figure>

    <section id='participant'><h2>GoodAir: the company that wants to perform the process</h2>

        <p>The new participant is a business providing an Air Quality Monitoring application as a service. The business is called GoodAir and it operates the application, which receives data from a set of sensors that may or may not be the property of GoodAir. The sensors must have received a certification to be able to operate and send data to the GoodAir application.
        </p>
        <p>The company is registered in the tax agency and business registry of Spain with VAT number <b>VATES-12345678</b>.
        </p>
    </section>
    <section><h2>COO (Chief Operating Officer) of GoodAir</h2>

        <p>The GoodAir company is small and the only person that can sign contracts on behalf of the company is the COO (Chief Operating Officer). The COO is a legal representative of the company and she is registered as so in the business registry of Spain.
        </p>
        <p>The COO has a certificate for electronic signatures issued by one of the TSPs in Spain enabling the COO to perform electronic qualified signatures as legal representative of GoodAir, instead of doing them manually.
        </p>
        <p>The X.509 certificate of the COO has the following contents in the <code>Subject</code> field (the example below is derived from a real certificate but with the identifiers modified to be an example):
        </p>

<pre class="nohighlight" style="color:#f8f8f2;background-color:#282a36;"><code><span style="display:flex;"><span><span style="color:#50fa7b">cn</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">56565656V Jesus Ruiz</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">serialNumber</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">56565656V</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">givenName</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">Jesus</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">sn</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">Ruiz</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">2.5.4.97</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">VATES-12345678</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">o</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">GoodAir</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">c</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">ES</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">2.5.4.13</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">Notary:Juan Lopez/Protocol Num:7172/Date:07-06-2021</span>
</span></span></code></pre>

        <p>The above set of fields bind the legal identity of the COO with the identity of the business:
        </p>
        <ul>
            <li id='339'><a href='#339' class='selfref'><b>-</b></a> <code>serialNumber</code> is the unique number recognized by the Spanish Government for spanish citizens (called NIF).
            </li>
            <li id='340'><a href='#340' class='selfref'><b>-</b></a> <code>2.5.4.97</code> is the <a href="https://oidref.com/2.5.4.97">official OID for <code>organizationIdentifier</code></a>. The contents of this field in the example certificate is the unique identifier for the legal person GoodAir.
            </li>
        </ul>
        <p>Before issuing a certificate like the above, the TSP has to perform some validations to ensure that in the official source of truth (the business registry of Spain in this case) there is already registered information that states that the COO has indeed powers to act on behalf of GoodAir as a legal representative.
        </p>
    </section>
    <section><h2>RealTruth: a Trust Service Provider</h2>

        <p>RealTruth is an EU TSP, which appears in the TL (Trusted List) maintained by the <a href="https://tl.bundesnetzagentur.de/TL-DE.XML">German Government</a>.
        </p>
        <p>RealTruth is a TSP based in Germany but operates in most of the countries of the EU and so being able to provide Trust Services across many countries, including Spain.
        </p>
        <p>As all TSPs in the TLs of the Member States, its entry in the TL includes one or more "Services" entries which describe the Trust Services provided by the TSP.
        </p>
        <p>A TSP can have one Service issuing certificates for signatures, another service issuing certificates for seals, another service for timestamping, etc.
        </p>
        <p>The regulator approves or suspends each service from a TSP individually, and the services are the root anchor for a given trust environment.
        </p>
        <p>In our case, the entry for RealTruth in the TL includes a `&ltTSPService&gt` entry, and inside it the `&ltServiceDigitalIdentity&gt` entry includes a DER-encoded certificate specifying the digital identity of the root anchor for that trust domain. The certificate for the Service has in the Subject field:
        </p>

<pre class="nohighlight" style="color:#f8f8f2;background-color:#282a36;"><code><span style="display:flex;"><span><span style="color:#50fa7b">2.5.4.97</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">VATDE-170173453</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">CN</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">DRV QC 11 MA CA 2017ca</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">OU</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">QC 11 Mitarbeiter CA</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">O</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">Deutsche Rentenversicherung Westfalen</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">C</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">DE</span>
</span></span></code></pre>

        <p>Which in the <code>organizationIdentifier</code> field (OID 2.5.4.97) specifies the unique organisation identifier assigned by the German regulatory authority to the TSP: VATDE-170173453.
        </p>
        <p>RealTruth provides `Legal Person Representative Certificates` which are qualified in accordance with Regulation (EU) No. 910/2014 of the European Parliament and of the Council of 23 July 2014 on electronic identification and trust services for electronic transactions in the internal market.
        </p>
        <p>The certification policies of RealTruth includes the following sentences:
        </p>
        <blockquote>
            <p>The Registration Authority must verify the following information in order to authenticate the identity of the organisation:
            </p>
            <ul>
                <li id='375'><a href='#375' class='selfref'><b>-</b></a> The data concerning the business name or corporate name of the organisation.
                </li>
                <li id='376'><a href='#376' class='selfref'><b>-</b></a> The data relating to the constitution and legal status of the subscriber.
                </li>
                <li id='377'><a href='#377' class='selfref'><b>-</b></a> <b>The data concerning the extent and validity of the powers of representation of the applicant.</b>
                </li>
                <li id='378'><a href='#378' class='selfref'><b>-</b></a> The data concerning the tax identification code of the organisation or equivalent code used in the country to whose legislation the subscriber is subject.
                </li>
            </ul>
        </blockquote>
        <p>The TSP (RealTruth in this case) performs the verifications against `Authentic Sources`.
        </p>
        <blockquote>
            <p>Authentic Sources are the public or private repositories or systems recognised or required by law containing attributes about a natural or legal persons.
            </p>
            <p>The Authentic Sources in scope of Annex VI of the [eIDAS2] legislative proposal are sources for attributes on address, age, gender, civil status, family composition, nationality, education and training qualifications titles and licences, professional qualifications titles and licences, public permits and licences, financial and company data.
            </p>
            <p>Authentic Sources in scope of Annex VI are required to provide interfaces to Qualified Electronic Attestation of Attributes  (QEAA) Providers to verify the authenticity of the above attributes, either directly or via designated intermediaries recognised at national level.
            </p>
            <p>Authentic Sources may also issue (Q)EAA-s themselves if they meet the requirements of the eIDAS Regulation. It is up to the Member States to define terms and conditions for the provisioning of these services, but according to the minimum technical specifications, standards, and procedures applicable to the verification procedures for qualified electronic attestations of attributes.
            </p>
        </blockquote>
        <figure><img src='builtassets/diagram_3fb1af3b42692d51c8a5e02feba9ad83.svg' alt=''>
        <figcaption></figcaption></figure>

        <p>In accordance to the policies, RealTruth made those validations when issuing the certificate to the COO, in such a way that the Relying Parties verifying the certificate can have a high level of trust in the assertion that the natural person identified in the certificate (with Spanish ID of 56565656V) is a legal representative of he GoodAir company (organizationIdentifier VATES-12345678).
        </p>
    </section>
    <section><h2>John Doe: an administrative employee of GoodAir</h2>

        <p>This is an employee of the central administration department of GoodAir, who is going to be formally nominated to manage a specific set of processes on behalf of GoodAir in the Data Space. In particular, this employee is going to be nominated as a LEAR (Legal Entity Appointed Representative).
        </p>
        <p>As its name implies, the LEAR has to be nominated by a <b>legal representative</b> of the GoodAir organisation with the necessary legal authority to commit the organisation for this type of decision. In our case, the COO of GoodAir will nominate John Doe as the LEAR of GoodAir, delegating to him the capabilities to perform some processes in the DOME portal and some other tasks in other organisations. That means that John Doe will not be empowered to perform cation snot explicitly specified in the credential.
        </p>
        <p>To perform the nomination, the COO of GoodAir (a legal representative of GoodAir) will issue a special credential to John Doe and will sign the credential with his certificate for signatures as legal representative of GoodAir. The details are described later in this document.
        </p>
    </section>
    <section><h2>DOME: an instance of a Data Space for Smart Cities</h2>

        <p>DOME is a Data Space where local governments can procure data and services from other entities that act as service providers. At the same time, the local governments can also act as data and service providers for other entities in the Data Space.
        </p>
        <p>The DOME Data Space has an portal service that allows external entities to perform some processes in an automated fashion by using Verifiable Credentials that have been issued by trusted entities. The complete Trust Framework used by DOME is composed from a series of Trust Frameworks, some managed internally using a governance model of DOME and some others managed externally but by trusted entities. At the root of the Trust Framework of DOME is the eIDAS Trust Framework and the pan-european recognized list of Trust Service Providers issuing the eIDAS compliant digital identities, in the form of certificates for signatures/seals.
        </p>
        <p>In order to participate in DOME, every legal person requires a certificate for seals or that one of its legal representatives has a certificate for signatures (or both). The DOME entity is registered in France with VAT number <b>VATFR-99999999</b>.
        </p>
    </section>
</section>
<section><h2>The LEARCredential</h2>

    <p>We use here a LEARCredential, described in detail in [[DID-ONBOARDING]], with different roles and duties embedded into the credential. The credential enables the employee (or subcontractor) to perform a specific sets of processes in the ecosystem, including interacting with other organisations in the ecosystem.
    </p>
    <p>We describe here the differences with respect to the example presented in [[DID-ONBOARDING]], to show how organisations can use LEARCredentials to enable secure, efficient, scalable and decentralised IAM (Identity and Access Management) to enable access to protected resources.
    </p>
    <p>The process of generation of the credential is the same, where the legal representative of the organisation will use his eIDAS certificate to sign the credential.
    </p>
    <p>The credential will be generated with an application that the COO will use as VC Issuer and that allows the employee to receive the credential using his credential wallet, using [[OpenID.VCI]] to achieve compliance with the EUDI Wallet ARF.
    </p>
    <p>The application enables the COO to specify the information required to create the LEARCredential, specifying the employee information and the specific type of LEARCredential. In general, there may be different instances of LEARCredentials for different purposes. One employee can have more than one LEARCredential, each having a different delegation of powers for different environments.
    </p>
    <section><h2>Claims identifying the employee</h2>

        <p>These are claims identifying the subject of the credential, the person who will act as LEAR. Each Data Space can define their own depending on their specific requirements.
        </p>
        <p>In addition, each organisation can specify their own for enabling access to its products/services. However, it is advisable to do this only when it is strictly required, and it is recommended to use a set of claims that are agreed upon by all participants in the ecosystem. This includes not only the amount of claims but also their syntax and semantics.
        </p>
        <p>An example set of claims is the following:
        </p>

<pre class="nohighlight" style="color:#f8f8f2;background-color:#282a36;"><code><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;title&#34;</span>: <span style="color:#f1fa8c">&#34;Mr.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;first_name&#34;</span>: <span style="color:#f1fa8c">&#34;John&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;last_name&#34;</span>: <span style="color:#f1fa8c">&#34;Doe&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;gender&#34;</span>: <span style="color:#f1fa8c">&#34;M&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;postal_address&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;email&#34;</span>: <span style="color:#f1fa8c">&#34;johndoe@goodair.com&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;telephone&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;fax&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;mobile_phone&#34;</span>: <span style="color:#f1fa8c">&#34;+34787426623&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre>

    </section>
    <section><h2>DID of the employee</h2>

        <p>The identifier of the employee is generated in exactly the same way as described in [[DID-ONBOARDING]], so we will not repeat it here.
        </p>
        <p>An example could be:
        </p>

<pre class="nohighlight" style="color:#f8f8f2;background-color:#282a36;"><code><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre>

        <p>With the DID for the employee, the set of claims identifying him would be then:
        </p>

<pre class="nohighlight" style="color:#f8f8f2;background-color:#282a36;"><code><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;title&#34;</span>: <span style="color:#f1fa8c">&#34;Mr.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;first_name&#34;</span>: <span style="color:#f1fa8c">&#34;John&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;last_name&#34;</span>: <span style="color:#f1fa8c">&#34;Doe&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;gender&#34;</span>: <span style="color:#f1fa8c">&#34;M&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;postal_address&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;email&#34;</span>: <span style="color:#f1fa8c">&#34;johndoe@goodair.com&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;telephone&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;fax&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;mobile_phone&#34;</span>: <span style="color:#f1fa8c">&#34;+34787426623&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre>

    </section>
    <section><h2><code>legalRepresentative</code></h2>

        <p>The legal representative is the same natural person as in [[DID-ONBOARDING]], that is the COO of GoodAir, represented in the credential as:
        </p>

<pre class="nohighlight" style="color:#f8f8f2;background-color:#282a36;"><code><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;legalRepresentative&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;cn&#34;</span>: <span style="color:#f1fa8c">&#34;56565656V Jesus Ruiz&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;serialNumber&#34;</span>: <span style="color:#f1fa8c">&#34;56565656V&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;organizationIdentifier&#34;</span>: <span style="color:#f1fa8c">&#34;VATES-12345678&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;o&#34;</span>: <span style="color:#f1fa8c">&#34;GoodAir&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;c&#34;</span>: <span style="color:#f1fa8c">&#34;ES&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre>

    </section>
    <section><h2><code>rolesAndDuties</code> of the LEAR</h2>

        <p>The <code>rolesAndDuties</code> are specified in the same way as in [[DID-ONBOARDING]], but the contents are different depending on the specific roles that the employee will have.
        </p>
        <p>A simplistic implementation of the object inside the credential could be:
        </p>

<pre class="nohighlight" style="color:#f8f8f2;background-color:#282a36;"><code><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;rolesAndDuties&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;type&#34;</span>: <span style="color:#f1fa8c">&#34;LEARCredential&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;https://dome-marketplace.eu//lear/v1/6484994n4r9e990494&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre>

        <p>Where the last part of the url can correspond to the hash of the external linked document to ensure that any modification or tampering can be detected. The contents of that object ata that url could be:
        </p>

<pre class="nohighlight" style="color:#f8f8f2;background-color:#282a36;"><code><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;https://dome-marketplace.eu//lear/v1/6484994n4r9e990494&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;target:&#34;</span>https:<span style="color:#6272a4">//bae.dome-marketplace.eu/&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#f1fa8c">&#34;roleNames&#34;</span>: [<span style="color:#f1fa8c">&#34;seller&#34;</span>, <span style="color:#f1fa8c">&#34;customer&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre>

        <p>In the above example, we have specified that the roles object referenced in the credential with `id: https://dome-marketplace.eu//lear/v1/6484994n4r9e990494` is granting the employee of GoodAir (in our example) to access services in the DOME marketplace (specified with the field <code>target</code>) with the roles <code>seller</code> and <code>customer</code> (which are the roles of the <a href="https://business-api-ecosystem.readthedocs.io/en/latest/index.html">FIWARE BAE component</a>).
        </p>
        <p>If <code>target</code> is omitted, the roles would apply to any target organisation. If we need to specify more than one target organisation, the array should include as many objects as required.
        </p>
        <aside class='note'>
            <p>The way we have specified the roles is just an example. There is work ongoing to define the detailed mechanism formally (e.g. with ODRL), and it is expected to change. This example is intended only to describe the concepts in detail.
            </p>
        </aside>
    </section>
    <section><h2>Assembling the pieces together</h2>

        <p>With the above values for the example, the complete LEARCredential would become something like this:
        </p>

<pre class="nohighlight" style="color:#f8f8f2;background-color:#282a36;"><code><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;@context&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;https://www.w3.org/2018/credentials/v1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;https://dome-marketplace.eu//2022/credentials/learcredential/v1&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;urn:did:elsi:25159389-8dd17b796ac0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;type&#34;</span>: [<span style="color:#f1fa8c">&#34;VerifiableCredential&#34;</span>, <span style="color:#f1fa8c">&#34;LEARCredential&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;issuer&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;did:elsi:VATES-12345678&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;issuanceDate&#34;</span>: <span style="color:#f1fa8c">&#34;2022-03-22T14:00:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;validFrom&#34;</span>: <span style="color:#f1fa8c">&#34;2022-03-22T14:00:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;expirationDate&#34;</span>: <span style="color:#f1fa8c">&#34;2023-03-22T14:00:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;credentialSubject&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;title&#34;</span>: <span style="color:#f1fa8c">&#34;Mr.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;first_name&#34;</span>: <span style="color:#f1fa8c">&#34;John&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;last_name&#34;</span>: <span style="color:#f1fa8c">&#34;Doe&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;gender&#34;</span>: <span style="color:#f1fa8c">&#34;M&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;postal_address&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;email&#34;</span>: <span style="color:#f1fa8c">&#34;johndoe@goodair.com&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;telephone&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;fax&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;mobile_phone&#34;</span>: <span style="color:#f1fa8c">&#34;+34787426623&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;legalRepresentative&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&#34;cn&#34;</span>: <span style="color:#f1fa8c">&#34;56565656V Jesus Ruiz&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&#34;serialNumber&#34;</span>: <span style="color:#f1fa8c">&#34;56565656V&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&#34;organizationIdentifier&#34;</span>: <span style="color:#f1fa8c">&#34;VATES-12345678&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&#34;o&#34;</span>: <span style="color:#f1fa8c">&#34;GoodAir&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&#34;c&#34;</span>: <span style="color:#f1fa8c">&#34;ES&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;rolesAndDuties&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&#34;type&#34;</span>: <span style="color:#f1fa8c">&#34;LEARCredential&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;https://dome-marketplace.eu//lear/v1/6484994n4r9e990494&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre>

        <p>Which is virtually identical to the one described in [[DID-ONBOARDING]].
        </p>
    </section>
</section>
<section><h2>Issuing the LEARCredential</h2>

    <section><h2>Overview</h2>

        <p>The issuance process of the LEARCredential used here is exactly the same as the one described in [[DID-ONBOARDING]] so we will focus on the differences.
        </p>
    </section>
    <section><h2>Authentication</h2>

        <p>This is exactly as in [[DID-ONBOARDING]].
        </p>
    </section>
    <section><h2>Credential Offer</h2>

        <p>This is exactly as in [[DID-ONBOARDING]].
        </p>
    </section>
    <section><h2>Credential Issuer Metadata</h2>

        <p>This is exactly as in [[DID-ONBOARDING]].
        </p>
    </section>
    <section><h2>OAuth 2.0 Authorization Server Metadata</h2>

        <p>This is exactly as in [[DID-ONBOARDING]].
        </p>
    </section>
    <section><h2>Access Token</h2>

        <p>This is exactly as in [[DID-ONBOARDING]].
        </p>
    </section>
    <section><h2>Request and receive Credential</h2>

        <p>This is exactly as in [[DID-ONBOARDING]].
        </p>
    </section>
</section>
<section><h2>Authenticating with the LEARCredential</h2>

    <section><h2>Overview</h2>

        <p>The diagram below is describes the high level logical architecture that we will be use as a reference for the detailed explanations in the next sections.
        </p>
        <p>The diagram uses the logical concepts also used in the XACML reference architecture, but the description is agnostic to the actual policy language used in a concrete implementation.
        </p>
        <p>In this description we assume that the user is a natural person who wants to access a protected resource. However, the architecture support machine-to-machine (M2M) interactions. The differences will be described in the description when they are relevant.
        </p>
        <figure><img src='images/login_in_DOME/authn_architecture_numbered.drawio.png'/>
        <figcaption>Architecture overview </figcaption></figure>
    </section>
</section>


</body>
</html>
